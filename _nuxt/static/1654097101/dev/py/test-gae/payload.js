__NUXT_JSONP__("/dev/py/test-gae", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_,$,aa,ab,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,ar,as,at,au,av,aw,ax,ay,az,aA,aB,aC,aD,aE,aF,aG,aH,aI){return {data:[{page:{slug:"test-gae",description:"Хардкод, моки, удаление лишнего",title:"Как тестировать Python 2 приложухи на GAE?",hideHeading:true,cover:aq,toc:[],body:{type:"root",children:[{type:b,tag:n,props:{className:[ad]},children:[{type:a,value:Y},{type:b,tag:n,props:{className:[I,J,K,L,M,N,O,P,ad]},children:[{type:a,value:e},{type:b,tag:n,props:{className:[Z]},children:[{type:a,value:e},{type:b,tag:m,props:{},children:[{type:b,tag:T,props:{},children:[{type:a,value:"Дисклеймер:"}]},{type:a,value:" писать на Python 2 и GAE Standard c Python 2 в 2022 - такое себе - у нас просто на работке легаси на этом, и надо как-то вариться в нем."}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:n,props:{className:[I,J,K,L,M,N,O,P,ad]},children:[{type:a,value:e},{type:b,tag:"h1",props:{className:["uppercase",Q,Z]},children:[{type:a,value:" Как тестировать Python 2 приложухи на GAE? "}]},{type:a,value:Y},{type:b,tag:"img-swiper",props:{},children:[{type:a,value:e},{type:b,tag:"img-block",props:{src:aq,alt:"Вот так"},children:[{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:n,props:{className:[I,J,K,L,M,N,O,P]},children:[{type:a,value:e},{type:b,tag:m,props:{},children:[{type:a,value:"Сперва, хочу сказать, что я..."}]},{type:a,value:e},{type:b,tag:n,props:{className:["text-3xl","md:text-5xl",ar,as]},children:[{type:a,value:"ПОЕБАЛСЯ ИЗРЯДНО"}]},{type:a,value:e},{type:b,tag:m,props:{},children:[{type:a,value:"но в итоге все ± робит"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:n,props:{className:[I,J,K,L,M,N,O,P]},children:[{type:a,value:e},{type:b,tag:m,props:{},children:[{type:a,value:"Итак,"}]},{type:a,value:e},{type:b,tag:ae,props:{className:[Q]},children:[{type:a,value:"\nЧего мы хотим от тестирования?\n"}]},{type:a,value:e},{type:b,tag:r,props:{},children:[{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"Легкость написания"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"Легкость запуска (руками и автоматически)"}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:n,props:{className:[I,J,K,L,M,N,O,P]},children:[{type:a,value:e},{type:b,tag:ae,props:{className:[Q]},children:[{type:a,value:" Легкость запуска "}]},{type:a,value:e},{type:b,tag:m,props:{},children:[{type:a,value:"Сначала надо запустить хоть какой-то код."}]},{type:a,value:e},{type:b,tag:m,props:{},children:[{type:b,tag:u,props:{},children:[{type:a,value:"Ведь, когда у тебя "},{type:b,tag:c,props:{className:[Q,Z]},children:[{type:a,value:"7-летнее"}]},{type:a,value:" легаси, которое тестится "},{type:b,tag:c,props:{className:[Q,Z]},children:[{type:a,value:"только в проде"}]},{type:a,value:", - это непростая задачка"}]}]},{type:a,value:e},{type:b,tag:U,props:{},children:[]},{type:a,value:e},{type:b,tag:_,props:{id:"zhmem-span-classtext-green-500span-i-chto-poluchaem"},children:[{type:b,tag:o,props:{href:"#%D0%B6%D0%BC%D0%B5%D0%BC-span-classtext-green-500span-%D0%B8-%D1%87%D1%82%D0%BE-%D0%BF%D0%BE%D0%BB%D1%83%D1%87%D0%B0%D0%B5%D0%BC",ariaHidden:v,tabIndex:w},children:[{type:b,tag:c,props:{className:[x,y]},children:[]}]},{type:a,value:"Жмем "},{type:b,tag:c,props:{className:["text-green-500"]},children:[{type:a,value:"▶"}]},{type:a,value:", и что получаем?"}]},{type:a,value:e},{type:b,tag:n,props:{className:["text-xl","md:text-3xl","text-red-500",ar,as]},children:[{type:a,value:e},{type:b,tag:m,props:{},children:[{type:a,value:"КУЧА КРАСНОГО ТЕКСТА"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:m,props:{},children:[{type:a,value:"Но его можно разбить на кучки:"}]},{type:a,value:e},{type:b,tag:af,props:{},children:[{type:a,value:"GAE SDK"}]},{type:a,value:Y},{type:b,tag:m,props:{},children:[{type:b,tag:g,props:{},children:[{type:a,value:"google.appengine.api.app_identity"}]},{type:a,value:", "},{type:b,tag:g,props:{},children:[{type:a,value:"google.appengine.api.modules"}]}]},{type:a,value:e},{type:b,tag:m,props:{},children:[{type:a,value:"Тут всякая инфа о приложении (проекте), типа айди, GCS-бакет - это "},{type:b,tag:u,props:{},children:[{type:b,tag:T,props:{},children:[{type:a,value:"хардкодим"}]}]},{type:a,value:" при получении исключения:"}]},{type:a,value:e},{type:b,tag:m,props:{},children:[{type:b,tag:g,props:{},children:[{type:a,value:"app_identity.get_application_id()"}]},{type:a,value:" \u003E "},{type:b,tag:g,props:{},children:[{type:a,value:"'project-id'"}]}]},{type:a,value:e},{type:b,tag:U,props:{},children:[]},{type:a,value:e},{type:b,tag:af,props:{id:"google-api"},children:[{type:b,tag:o,props:{href:"#google-api",ariaHidden:v,tabIndex:w},children:[{type:b,tag:c,props:{className:[x,y]},children:[]}]},{type:a,value:"Google API"}]},{type:a,value:e},{type:b,tag:m,props:{},children:[{type:b,tag:g,props:{},children:[{type:a,value:"googleapiclient.descovery.build"}]}]},{type:a,value:e},{type:b,tag:m,props:{},children:[{type:a,value:"Создает апи-клиент для работы с гугл-сервисами, типа BigQuery"}]},{type:a,value:e},{type:b,tag:m,props:{},children:[{type:a,value:"Это дело "},{type:b,tag:u,props:{},children:[{type:b,tag:T,props:{},children:[{type:a,value:"мокаем"}]}]},{type:a,value:" при ошибках:"}]},{type:a,value:e},{type:b,tag:m,props:{},children:[{type:b,tag:g,props:{},children:[{type:a,value:"service = mock.MagicMock()"}]}]},{type:a,value:e},{type:b,tag:U,props:{},children:[]},{type:a,value:e},{type:b,tag:af,props:{id:"hz-chto"},children:[{type:b,tag:o,props:{href:"#%D1%85%D0%B7-%D1%87%D1%82%D0%BE",ariaHidden:v,tabIndex:w},children:[{type:b,tag:c,props:{className:[x,y]},children:[]}]},{type:a,value:"Хз что"}]},{type:a,value:e},{type:b,tag:m,props:{},children:[{type:a,value:"Скорее всего, это мусор - "},{type:b,tag:u,props:{},children:[{type:b,tag:T,props:{},children:[{type:a,value:"удаляем"}]}]},{type:a,value:" его"}]},{type:a,value:e},{type:b,tag:U,props:{},children:[]},{type:a,value:e},{type:b,tag:_,props:{id:"zapuskaem-testy"},children:[{type:b,tag:o,props:{href:"#%D0%B7%D0%B0%D0%BF%D1%83%D1%81%D0%BA%D0%B0%D0%B5%D0%BC-%D1%82%D0%B5%D1%81%D1%82%D1%8B",ariaHidden:v,tabIndex:w},children:[{type:b,tag:c,props:{className:[x,y]},children:[]}]},{type:a,value:"Запускаем тесты"}]},{type:a,value:e},{type:b,tag:"ol",props:{},children:[{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:e},{type:b,tag:m,props:{},children:[{type:a,value:"Создаем venv + ставим "},{type:b,tag:o,props:{href:"https:\u002F\u002Fdocs.pytest.org\u002Fen\u002F7.0.x\u002F",rel:[z,A,B],target:C},children:[{type:a,value:at}]},{type:a,value:" - "},{type:b,tag:u,props:{},children:[{type:a,value:"ну по классике"}]}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:e},{type:b,tag:m,props:{},children:[{type:a,value:"Ставим "},{type:b,tag:o,props:{href:"https:\u002F\u002Fpypi.org\u002Fproject\u002Fappengine-sdk\u002F",rel:[z,A,B],target:C},children:[{type:a,value:"gae-sdk"}]},{type:a,value:" в venv - "},{type:b,tag:u,props:{},children:[{type:a,value:"оказывается, так можно"}]}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:e},{type:b,tag:m,props:{},children:[{type:a,value:"Создаем конфиг - "},{type:b,tag:g,props:{},children:[{type:a,value:"pytest.ini"}]},{type:a,value:" \u002F "},{type:b,tag:g,props:{},children:[{type:a,value:"setup.cfg"}]},{type:a,value:p}]},{type:a,value:e},{type:b,tag:n,props:{className:[D]},children:[{type:b,tag:E,props:{className:[F,"language-ini"]},children:[{type:b,tag:g,props:{},children:[{type:b,tag:c,props:{className:[d,"selector"]},children:[{type:a,value:"[pytest]"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,au]},children:[{type:a,value:"addops"}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,av]},children:[{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:s}]},{type:a,value:" --doctest-modules"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,au]},children:[{type:a,value:"testpaths"}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,av]},children:[{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:s}]},{type:a,value:" tests any_packet"}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:r,props:{},children:[{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:g,props:{},children:[{type:a,value:"addops = --doctest-modules"}]},{type:a,value:" - включаем доктесты"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:u,props:{},children:[{type:a,value:"К слову: те доктесты, которые не хотим запускать, можно игнорить, используя "},{type:b,tag:g,props:{},children:[{type:a,value:"# doctest: +SKIP"}]},{type:a,value:" в конце строки доктеста"}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:g,props:{},children:[{type:a,value:"testpaths = "}]},{type:a,value:" - поиск тестов в определенных директориях, а не во всем проекте"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"Мы внедряем тесты потихоньку, так что написали всего один прод-пакет - "},{type:b,tag:g,props:{},children:[{type:a,value:"any_packet"}]}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:e},{type:b,tag:m,props:{},children:[{type:a,value:"Создаем "},{type:b,tag:g,props:{},children:[{type:a,value:"tests\u002Fconftest.py"}]},{type:a,value:p}]},{type:a,value:e},{type:b,tag:n,props:{className:[D]},children:[{type:b,tag:E,props:{className:[F,R]},children:[{type:b,tag:g,props:{},children:[{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:V}]},{type:a,value:ag},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:ah},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:aw},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:W}]},{type:a,value:" vendor\n\n"},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:$}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,aa]},children:[{type:a,value:ax}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:i}]},{type:a,value:"session"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:p}]},{type:a,value:"\n  vendor"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:"add"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,ai]},children:[{type:a,value:"'lib'"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:r,props:{},children:[{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:g,props:{},children:[{type:a,value:ax}]},{type:a,value:" запускается перед всеми тестами"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:g,props:{},children:[{type:a,value:"vendor.add('lib')"}]},{type:a,value:" добавляет либы из "},{type:b,tag:g,props:{},children:[{type:a,value:"lib\u002F"}]},{type:a,value:ay},{type:b,tag:g,props:{},children:[{type:a,value:"PYTHONPATH"}]},{type:a,value:" (чтобы они подсосались в рантайм)"}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:e},{type:b,tag:m,props:{},children:[{type:a,value:"Все, теперь можно одним словом запускать тесты - "},{type:b,tag:g,props:{},children:[{type:a,value:at}]}]},{type:a,value:e},{type:b,tag:r,props:{},children:[{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"Это же можно запускать на CI \u002F pre-commit"}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:n,props:{className:[I,J,K,L,M,N,O,P]},children:[{type:a,value:e},{type:b,tag:ae,props:{className:[Q]},children:[{type:a,value:" Легкость написания "}]},{type:a,value:e},{type:b,tag:m,props:{},children:[{type:a,value:"pytest сам по себе простой - тесты можно писать как функции с assert-ами, но для GAE нужно пару приблуд"}]},{type:a,value:e},{type:b,tag:_,props:{id:"testy-ndb"},children:[{type:b,tag:o,props:{href:"#%D1%82%D0%B5%D1%81%D1%82%D1%8B-ndb",ariaHidden:v,tabIndex:w},children:[{type:b,tag:c,props:{className:[x,y]},children:[]}]},{type:a,value:"Тесты ndb"}]},{type:a,value:e},{type:b,tag:r,props:{},children:[{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"GAE SDK содержит утилиты для написания тестов - "},{type:b,tag:o,props:{href:"https:\u002F\u002Fcloud.google.com\u002Fappengine\u002Fdocs\u002Fstandard\u002Fpython\u002Ftools\u002Flocalunittesting",rel:[z,A,B],target:C},children:[{type:a,value:"testbed"}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"Дружим pytest и testbed, создавая фикстуру:"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:n,props:{className:[D]},children:[{type:b,tag:E,props:{className:[F,R]},children:[{type:b,tag:g,props:{},children:[{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:V}]},{type:a,value:ag},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:ah},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:aw},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:W}]},{type:a,value:" ndb"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:S}]},{type:a,value:" testbed\n\n"},{type:b,tag:c,props:{className:[d,az,aA,f]},children:[{type:a,value:"@pytest"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:"fixture"}]},{type:a,value:e},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:$}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,aa]},children:[{type:a,value:aB}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:p}]},{type:a,value:"\n  testbed_ "},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:s}]},{type:a,value:" testbed"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:"Testbed"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:ab},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:"activate"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:ab},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:"init_datastore_v3_stub"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:ab},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:"init_memcache_stub"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:"\n  ndb"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:"get_context"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:"clear_cache"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:X},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:"yield"}]},{type:a,value:ab},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:"deactivate"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:Y}]}]}]},{type:a,value:e},{type:b,tag:r,props:{},children:[{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"Используем ее везде, где тестируются ndb-модельки:"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:n,props:{className:[D]},children:[{type:b,tag:E,props:{className:[F,R]},children:[{type:b,tag:g,props:{},children:[{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:$}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,aa]},children:[{type:a,value:"test_insert_entity"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:i}]},{type:a,value:aB},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:p}]},{type:a,value:"\n  TestModel"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:aj},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:"\n  self"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:"assertEqual"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,aC]},children:[{type:a,value:"1"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:S}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,"builtin"]},children:[{type:a,value:"len"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:i}]},{type:a,value:"TestModel"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:"query"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:"fetch"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,aC]},children:[{type:a,value:"2"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:"    \n"}]}]}]},{type:a,value:e},{type:b,tag:U,props:{},children:[]},{type:a,value:e},{type:b,tag:_,props:{id:"factoryboy--ndb"},children:[{type:b,tag:o,props:{href:"#factoryboy--ndb",ariaHidden:v,tabIndex:w},children:[{type:b,tag:c,props:{className:[x,y]},children:[]}]},{type:a,value:"FactoryBoy + ndb"}]},{type:a,value:e},{type:b,tag:r,props:{},children:[{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"Удобно создавать сущности с большой вложенностью с помощью "},{type:b,tag:o,props:{href:"https:\u002F\u002Ffactoryboy.readthedocs.io\u002Fen\u002Fstable\u002F",rel:[z,A,B],target:C},children:[{type:a,value:"factoryboy"}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"Есть модификация для ndb - "},{type:b,tag:o,props:{href:"https:\u002F\u002Fgithub.com\u002Fanentropic\u002Ffactoryboy-gaendb",rel:[z,A,B],target:C},children:[{type:a,value:"factoryboy-gaendb"}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"Но она не работает! Я даже "},{type:b,tag:o,props:{href:"https:\u002F\u002Fgithub.com\u002Fpotykion\u002Ffactoryboy-gaendb",rel:[z,A,B],target:C},children:[{type:a,value:"форк"}]},{type:a,value:" создал, и все равно не работает. И последний раз либа обновлялась 4 года назад и "},{type:b,tag:u,props:{},children:[{type:a,value:"ваще"}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"Так что будем дружить factoryboy и ndb самостоятельно"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"Дружить будем на примере 2 моделек: "},{type:b,tag:g,props:{},children:[{type:a,value:ak}]},{type:a,value:" - заказ доставки товаров\u002Fеды\u002Fчего-угодно и "},{type:b,tag:g,props:{},children:[{type:a,value:aD}]},{type:a,value:" - чел, совершивший заказ"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:al,props:{id:"vyzov-put-dlya-sohraneniya-instanca"},children:[{type:b,tag:o,props:{href:"#%D0%B2%D1%8B%D0%B7%D0%BE%D0%B2-put-%D0%B4%D0%BB%D1%8F-%D1%81%D0%BE%D1%85%D1%80%D0%B0%D0%BD%D0%B5%D0%BD%D0%B8%D1%8F-%D0%B8%D0%BD%D1%81%D1%82%D0%B0%D0%BD%D1%86%D0%B0",ariaHidden:v,tabIndex:w},children:[{type:b,tag:c,props:{className:[x,y]},children:[]}]},{type:a,value:"Вызов "},{type:b,tag:g,props:{},children:[{type:a,value:aE}]},{type:a,value:" для сохранения инстанца"}]},{type:a,value:e},{type:b,tag:r,props:{},children:[{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"По умолчанию factoryboy вызывает метод "},{type:b,tag:g,props:{},children:[{type:a,value:".save()"}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"У GAE сущностей, этот методы называется иначе - "},{type:b,tag:g,props:{},children:[{type:a,value:aE}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"Какой методы вызвать после создания модели в factoryboy можно, используя "},{type:b,tag:g,props:{},children:[{type:a,value:"Factory.post_generation"}]},{type:a,value:p}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:n,props:{className:[D]},children:[{type:b,tag:E,props:{className:[F,R]},children:[{type:b,tag:g,props:{},children:[{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:V}]},{type:a,value:aF},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:W}]},{type:a,value:" Factory"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:S}]},{type:a,value:" post_generation\n\n"},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:G}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,H]},children:[{type:a,value:aG}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:i}]},{type:a,value:am},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:p}]},{type:a,value:X},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:G}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,H]},children:[{type:a,value:an}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:p}]},{type:a,value:" \n    model "},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:s}]},{type:a,value:" Client\n\n  "},{type:b,tag:c,props:{className:[d,az,aA,f]},children:[{type:a,value:"@post_generation"}]},{type:a,value:X},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:$}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,aa]},children:[{type:a,value:aj}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:i}]},{type:a,value:"obj"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:S}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:"*"}]},{type:a,value:"args"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:S}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:"**"}]},{type:a,value:"kwargs"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:p}]},{type:a,value:"\n    obj"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:aj},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:r,props:{},children:[{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:g,props:{},children:[{type:a,value:"post_generation"}]},{type:a,value:" вызывается после создания инстанца фабрики, то есть после "},{type:b,tag:g,props:{},children:[{type:a,value:"ClientFactory()"}]}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:al,props:{id:"svyazi-s-drugimi-modelyami---ndbkeyproperty"},children:[{type:b,tag:o,props:{href:"#%D1%81%D0%B2%D1%8F%D0%B7%D0%B8-%D1%81-%D0%B4%D1%80%D1%83%D0%B3%D0%B8%D0%BC%D0%B8-%D0%BC%D0%BE%D0%B4%D0%B5%D0%BB%D1%8F%D0%BC%D0%B8---ndbkeyproperty",ariaHidden:v,tabIndex:w},children:[{type:b,tag:c,props:{className:[x,y]},children:[]}]},{type:a,value:"Связи с другими моделями - "},{type:b,tag:g,props:{},children:[{type:a,value:"ndb.KeyProperty"}]}]},{type:a,value:e},{type:b,tag:r,props:{},children:[{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"Для того чтобы связать 2 модели, нужно при создании "},{type:b,tag:g,props:{},children:[{type:a,value:ak}]},{type:a,value:" создавать "},{type:b,tag:g,props:{},children:[{type:a,value:aD}]},{type:a,value:", и проставлять "},{type:b,tag:g,props:{},children:[{type:a,value:"Client.key"}]},{type:a,value:ay},{type:b,tag:g,props:{},children:[{type:a,value:ak}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"Если в Django достаточно просто "},{type:b,tag:g,props:{},children:[{type:a,value:"factory.SubFactory"}]},{type:a,value:", то в случае GAE нам нужно получить "},{type:b,tag:g,props:{},children:[{type:a,value:".key"}]},{type:a,value:" у сущности, которая создалать через "},{type:b,tag:g,props:{},children:[{type:a,value:"SubFactory"}]},{type:a,value:", а больше нам сущность не нужна"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"Для этого используем 2 хитрости: "},{type:b,tag:g,props:{},children:[{type:a,value:ac}]},{type:a,value:" и "},{type:b,tag:g,props:{},children:[{type:a,value:ao}]},{type:a,value:p}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:n,props:{className:[D]},children:[{type:b,tag:E,props:{className:[F,R]},children:[{type:b,tag:g,props:{},children:[{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:G}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,H]},children:[{type:a,value:"OrderFactory"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:i}]},{type:a,value:am},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:p}]},{type:a,value:X},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:G}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,H]},children:[{type:a,value:an}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:p}]},{type:a,value:"\n      model "},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:s}]},{type:a,value:" Order\n\n  "},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:G}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,H]},children:[{type:a,value:ac}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:p}]},{type:a,value:"\n      client "},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:s}]},{type:a,value:" SubFactory"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:i}]},{type:a,value:aG},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:"\n\n  client "},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:s}]},{type:a,value:" factory"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:ao},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:"lambda"}]},{type:a,value:aH},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:p}]},{type:a,value:aH},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:"client"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:"key"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:r,props:{},children:[{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:g,props:{},children:[{type:a,value:ac}]},{type:a,value:" позволяет создавать сущности \u002F данные без передачи в контруктор модели фабрики"}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:u,props:{},children:[{type:a,value:"К слову: "},{type:b,tag:g,props:{},children:[{type:a,value:ac}]},{type:a,value:" можно переопредять в конструкторе фабрики"}]}]},{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:g,props:{},children:[{type:a,value:ao}]},{type:a,value:" позволяет брать не всю сущность, а лишь одно значение - а это то что нам нужно для "},{type:b,tag:g,props:{},children:[{type:a,value:"KeyProperty"}]}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:al,props:{id:"ndb-primitivy---ndbgeopt"},children:[{type:b,tag:o,props:{href:"#ndb-%D0%BF%D1%80%D0%B8%D0%BC%D0%B8%D1%82%D0%B8%D0%B2%D1%8B---ndbgeopt",ariaHidden:v,tabIndex:w},children:[{type:b,tag:c,props:{className:[x,y]},children:[]}]},{type:a,value:"ndb-примитивы - "},{type:b,tag:g,props:{},children:[{type:a,value:"ndb.GeoPt"}]},{type:a,value:p}]},{type:a,value:e},{type:b,tag:r,props:{},children:[{type:a,value:e},{type:b,tag:h,props:{},children:[{type:a,value:"Тут все просто - делаем фабрику, которая будет создавать примитив, проставляя рандомные координаты с помощью "},{type:b,tag:o,props:{href:"https:\u002F\u002Ffaker.readthedocs.io\u002Fen\u002Fmaster\u002F",rel:[z,A,B],target:C},children:[{type:a,value:"Faker"}]},{type:a,value:" :"}]},{type:a,value:e}]},{type:a,value:e},{type:b,tag:n,props:{className:[D]},children:[{type:b,tag:E,props:{className:[F,R]},children:[{type:b,tag:g,props:{},children:[{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:V}]},{type:a,value:aF},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:W}]},{type:a,value:ap},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:S}]},{type:a,value:" Factory\n"},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:V}]},{type:a,value:ag},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:ah},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:"api"},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:k}]},{type:a,value:"datastore_types "},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:W}]},{type:a,value:" GeoPt\n\n"},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:G}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,H]},children:[{type:a,value:"GeoPtFactory"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:i}]},{type:a,value:am},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:p}]},{type:a,value:X},{type:b,tag:c,props:{className:[d,l]},children:[{type:a,value:G}]},{type:a,value:q},{type:b,tag:c,props:{className:[d,H]},children:[{type:a,value:an}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:p}]},{type:a,value:"\n    model "},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:s}]},{type:a,value:" GeoPt\n\n  lat "},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:s}]},{type:a,value:ap},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,ai]},children:[{type:a,value:"'latitude'"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:"\n  lon "},{type:b,tag:c,props:{className:[d,t]},children:[{type:a,value:s}]},{type:a,value:ap},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:i}]},{type:b,tag:c,props:{className:[d,ai]},children:[{type:a,value:"'longitude'"}]},{type:b,tag:c,props:{className:[d,f]},children:[{type:a,value:j}]},{type:a,value:e}]}]}]},{type:a,value:e},{type:b,tag:r,props:{},children:[{type:a,value:e},{type:b,tag:h,props:{},children:[{type:b,tag:T,props:{},children:[{type:a,value:"Важно:"}]},{type:a,value:" factoryboy "},{type:b,tag:o,props:{href:"https:\u002F\u002Ffactoryboy.readthedocs.io\u002Fen\u002Fstable\u002F_modules\u002Ffactory\u002Ffaker.html",rel:[z,A,B],target:C},children:[{type:a,value:"интегрируется с Faker"}]},{type:a,value:", так что импортировать Faker нужно из "},{type:b,tag:g,props:{},children:[{type:a,value:"factory"}]}]},{type:a,value:e}]},{type:a,value:e}]},{type:a,value:e}]}]},dir:"\u002Fdev\u002Fpy",path:"\u002Fdev\u002Fpy\u002Ftest-gae",extension:".md",createdAt:aI,updatedAt:aI}}],fetch:{},mutations:[]}}("text","element","span","token","\n","punctuation","code","li","(",")",".","keyword","p","div","a",":"," ","ul","=","operator","em","true",-1,"icon","icon-link","nofollow","noopener","noreferrer","_blank","nuxt-content-highlight","pre","line-numbers","class","class-name","bg-white","md:py-4","md:px-6","py-2","px-4","rounded-lg","md:text-xl","text-lg","font-bold","language-python",",","strong","hr","from","import","\n  "," \n","italic","h3","def","function","\n  testbed_","Params","space-y-4","h2","h4"," google","appengine","string","put","Order","h5","Factory","Meta","LazyAttribute"," Faker","\u002Fimages\u002Fdev\u002Fpy\u002Ftest-gae\u002Fpy2-gae-testing.jpg","font-black","tracking-widest","pytest","constant","attr-value","ext ","pytest_sessionstart"," в ","decorator","annotation","mock_ndb","number","Client",".put()"," factory ","ClientFactory"," o","2022-06-01T15:22:47.342Z")));