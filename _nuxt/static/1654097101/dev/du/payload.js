__NUXT_JSONP__("/dev/du", (function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P){return {data:[{page:{slug:w,description:"Для серва много места на диске не надо, но оно почему-то куда-то пропадает, разбираемся куда, и как чистить",title:"Освобождаем место на Linux и в Docker",cover:"\u002Fimages\u002Fdev\u002Fdu\u002Fcover.jpg",toc:[{id:A,depth:y,text:B},{id:x,depth:q,text:x},{id:w,depth:q,text:w},{id:C,depth:q,text:D},{id:E,depth:y,text:F},{id:G,depth:q,text:H},{id:I,depth:q,text:J},{id:K,depth:y,text:L},{id:M,depth:q,text:N}],body:{type:"root",children:[{type:b,tag:z,props:{id:A},children:[{type:b,tag:e,props:{href:"#%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%B0",ariaHidden:l,tabIndex:m},children:[{type:b,tag:n,props:{className:[o,p]},children:[]}]},{type:a,value:B}]},{type:a,value:c},{type:b,tag:r,props:{id:x},children:[{type:b,tag:e,props:{href:"#df",ariaHidden:l,tabIndex:m},children:[{type:b,tag:n,props:{className:[o,p]},children:[]}]},{type:a,value:x}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Эта команда показывает сколько места осталось на машинке:"}]},{type:a,value:c},{type:b,tag:g,props:{className:[h]},children:[{type:b,tag:i,props:{className:[j,k]},children:[{type:b,tag:f,props:{},children:[{type:a,value:"df -h\n\nFilesystem      Size  Used Avail Use% Mounted on\nudev            2.0G     0  2.0G   0% \u002Fdev\ntmpfs           395M  8.4M  387M   3% \u002Frun\n\u002Fdev\u002Fvda2        13G  8.5G  3.8G  70% \u002F\ntmpfs           2.0G     0  2.0G   0% \u002Fdev\u002Fshm\ntmpfs           5.0M     0  5.0M   0% \u002Frun\u002Flock\ntmpfs           2.0G     0  2.0G   0% \u002Fsys\u002Ffs\u002Fcgroup\ntmpfs           395M     0  395M   0% \u002Frun\u002Fuser\u002F1000\n"}]}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Видим, что корневая директория ("},{type:b,tag:f,props:{},children:[{type:a,value:"\u002F"}]},{type:a,value:") занимает больше всего места. Глянем что там внутри"}]},{type:a,value:c},{type:b,tag:r,props:{id:w},children:[{type:b,tag:e,props:{href:"#du",ariaHidden:l,tabIndex:m},children:[{type:b,tag:n,props:{className:[o,p]},children:[]}]},{type:a,value:w}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Эта команда показывает сколько места занимает каждая директория внутри директории:"}]},{type:a,value:c},{type:b,tag:g,props:{className:[h]},children:[{type:b,tag:i,props:{className:[j,k]},children:[{type:b,tag:f,props:{},children:[{type:a,value:"sudo du -h \u002F --max-depth=1\n\n36K     \u002Froot\n4.0K    \u002Fmnt\n1.8G    \u002Fhome\n6.2G    \u002Fvar\n12M     \u002Fbin\n26M     \u002Ftmp\n8.0K    \u002Fmedia\n107M    \u002Fboot\n837M    \u002Flib\n0       \u002Fsys\n31M     \u002Fopt\n4.0K    \u002Flib64\n1.6G    \u002Fusr\n16K     \u002Flost+found\n4.0K    \u002Fsrv\n8.5M    \u002Frun\n4.8M    \u002Fetc\n0       \u002Fdev\n0       \u002Fproc\n8.5M    \u002Fsbin\n11G     \u002F\n"}]}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Видим, что больше всего места занимает директория "},{type:b,tag:f,props:{},children:[{type:a,value:"\u002Fvar"}]},{type:a,value:", заглянем туда:"}]},{type:a,value:c},{type:b,tag:g,props:{className:[h]},children:[{type:b,tag:i,props:{className:[j,k]},children:[{type:b,tag:f,props:{},children:[{type:a,value:"sudo du -h \u002Fvar --max-depth=1\n\n1.4M    \u002Fvar\u002Fbackups\n4.0K    \u002Fvar\u002Flocal\n20K     \u002Fvar\u002Ftmp\n4.0K    \u002Fvar\u002Fmail\n5.8G    \u002Fvar\u002Flib\n180K    \u002Fvar\u002Fopt\n16K     \u002Fvar\u002Fspool\n210M    \u002Fvar\u002Fcache\n137M    \u002Fvar\u002Flog\n6.2G    \u002Fvar\n"}]}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Видим, что "},{type:b,tag:f,props:{},children:[{type:a,value:"\u002Fvar\u002Flib"}]},{type:a,value:" много занимает, залезем еще глубже:"}]},{type:a,value:c},{type:b,tag:g,props:{className:[h]},children:[{type:b,tag:i,props:{className:[j,k]},children:[{type:b,tag:f,props:{},children:[{type:a,value:"sudo du -h \u002Fvar\u002Flib --max-depth=1\n\n24K     \u002Fvar\u002Flib\u002Femacsen-common\n12K     \u002Fvar\u002Flib\u002Fprivate\n288K    \u002Fvar\u002Flib\u002Fcloud\n5.6G    \u002Fvar\u002Flib\u002Fdocker\n4.0K    \u002Fvar\u002Flib\u002Fdhcp\n31M     \u002Fvar\u002Flib\u002Fdpkg\n300K    \u002Fvar\u002Flib\u002Fcontainerd\n8.0K    \u002Fvar\u002Flib\u002Fispell\n12M     \u002Fvar\u002Flib\u002Fmlocate\n196M    \u002Fvar\u002Flib\u002Fapt\n12K     \u002Fvar\u002Flib\u002FAccountsService\n12K     \u002Fvar\u002Flib\u002Finitramfs-tools\n28K     \u002Fvar\u002Flib\u002Fpam\n544K    \u002Fvar\u002Flib\u002Fusbutils\n12K     \u002Fvar\u002Flib\u002Flocales\n96K     \u002Fvar\u002Flib\u002Fucf\n296K    \u002Fvar\u002Flib\u002Fsystemd\n16K     \u002Fvar\u002Flib\u002Fdictionaries-common\n16K     \u002Fvar\u002Flib\u002Fpolkit-1\n12K     \u002Fvar\u002Flib\u002Fgrub\n12K     \u002Fvar\u002Flib\u002Fupdate-manager\n5.8G    \u002Fvar\u002Flib\n"}]}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Видим, что Docker много места занимает, ща перейдем к нему, но сначала еще пару слов о частых жирных директориях"}]},{type:a,value:c},{type:b,tag:r,props:{id:C},children:[{type:b,tag:e,props:{href:"#varlogjournal",ariaHidden:l,tabIndex:m},children:[{type:b,tag:n,props:{className:[o,p]},children:[]}]},{type:a,value:D}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Я не сохранил лог про эту директорию, но, траст ми, она была жирной. И на стеке есть даже вопрос "},{type:b,tag:e,props:{href:"https:\u002F\u002Faskubuntu.com\u002Fquestions\u002F1238214\u002Fbig-var-log-journal",rel:[s,t,u],target:v},children:[{type:a,value:"че эта директория такая жирная"}]},{type:a,value:", ну и лечется это так:"}]},{type:a,value:c},{type:b,tag:g,props:{className:[h]},children:[{type:b,tag:i,props:{className:[j,k]},children:[{type:b,tag:f,props:{},children:[{type:a,value:"journalctl --vacuum-size=100M\n"}]}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Так что есть смысл чекнуть эту директорию и почистить ее."}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Все, возвращаемся к Докеру"}]},{type:a,value:c},{type:b,tag:z,props:{id:E},children:[{type:b,tag:e,props:{href:"#docker",ariaHidden:l,tabIndex:m},children:[{type:b,tag:n,props:{className:[o,p]},children:[]}]},{type:a,value:F}]},{type:a,value:c},{type:b,tag:r,props:{id:G},children:[{type:b,tag:e,props:{href:"#docker-system-df",ariaHidden:l,tabIndex:m},children:[{type:b,tag:n,props:{className:[o,p]},children:[]}]},{type:a,value:H}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Для Докера есть свой аналог "},{type:b,tag:e,props:{href:"https:\u002F\u002Fdocs.docker.com\u002Fengine\u002Freference\u002Fcommandline\u002Fsystem_df\u002F",rel:[s,t,u],target:v},children:[{type:a,value:"команды, показывающей занятое место"}]},{type:a,value:":"}]},{type:a,value:c},{type:b,tag:g,props:{className:[h]},children:[{type:b,tag:i,props:{className:[j,k]},children:[{type:b,tag:f,props:{},children:[{type:a,value:"docker system df -v\n\nImages space usage:\n\nREPOSITORY            TAG                 IMAGE ID            CREATED             SIZE                SHARED SIZE         UNIQUE SIZE         CONTAINERS\nrbcn_legals_server    latest              54a550fee267        19 hours ago        1.704GB             0B                  1.704GB             1\nrbcn_legals_stunnel   latest              77785c6d80cd        19 hours ago        158.5MB             0B                  158.5MB             1\nrbcn_legals_front     latest              33938bf871fe        19 hours ago        132.3MB             0B                  132.3MB             1\ntraefik               latest              77d3b9e70c48        2 months ago        92.04MB             0B                  92.04MB             1\n\nContainers space usage:\n\nCONTAINER ID        IMAGE                 COMMAND                  LOCAL VOLUMES       SIZE                CREATED             STATUS              NAMES\n00fc0f3d1fe1        rbcn_legals_front     \"nginx -g 'daemon of…\"   0                   2B                  19 hours ago        Up 19 hours         rbcn_legals_front_1\n133f5d847aa2        rbcn_legals_server    \"\u002Fbin\u002Fsh -c 'poetry …\"   0                   1.67MB              19 hours ago        Up 19 hours         rbcn_legals_server_1\nf69f214f4961        rbcn_legals_stunnel   \"\u002Fbin\u002Fsh -c '\u002Fopt\u002Fcp…\"   0                   899B                19 hours ago        Up 19 hours         rbcn_legals_stunnel_1\n355556a13591        traefik               \"\u002Fentrypoint.sh --pr…\"   1                   0B                  2 months ago        Up 2 months         rbcn_legals_traefik_1\n\nLocal Volumes space usage:\n\nVOLUME NAME                               LINKS               SIZE\nrbcn_legals_traefik-public-certificates   1                   15.96kB\n\nBuild cache usage: 0B\n\nCACHE ID            CACHE TYPE          SIZE                CREATED             LAST USED           USAGE               SHARED\n"}]}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"У меня здесь все чистенько (хотя серверный имедж жирноват), а у вас может быть нет."}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Имеется в виду, то, что у меня всего 4 имеджа и все используются."}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"А может так, что много имеджей лежит без дела, и они просто занимают место:"}]},{type:a,value:c},{type:b,tag:g,props:{className:[h]},children:[{type:b,tag:i,props:{className:[j,k]},children:[{type:b,tag:f,props:{},children:[{type:a,value:"docker system df -v\n\nImages space usage:\n\nREPOSITORY            TAG       IMAGE ID       CREATED         SIZE      SHARED SIZE   UNIQUE SIZE   CONTAINERS\n\u003Cnone\u003E                \u003Cnone\u003E    797da5dbd450   2 months ago    158.6MB   72.78MB       85.81MB       0\n\u003Cnone\u003E                \u003Cnone\u003E    3b60b43d10d4   2 months ago    158.6MB   72.78MB       85.82MB       0\n\u003Cnone\u003E                \u003Cnone\u003E    2f1e6d19b586   2 months ago    158.6MB   72.78MB       85.81MB       0\n\u003Cnone\u003E                \u003Cnone\u003E    ed05c8257097   2 months ago    158.6MB   72.78MB       85.81MB       0\n\u003Cnone\u003E                \u003Cnone\u003E    da322046ebd4   3 months ago    1.653GB   1.224GB       428.9MB       0\n\u003Cnone\u003E                \u003Cnone\u003E    446ffe4e6819   3 months ago    1.653GB   1.224GB       428.9MB       0\n\u003Cnone\u003E                \u003Cnone\u003E    e54c6911174c   3 months ago    158.6MB   158.6MB       8.502kB       0\n\u003Cnone\u003E                \u003Cnone\u003E    725e316bbe89   3 months ago    1.602GB   1.224GB       377.7MB       0\n\u003Cnone\u003E                \u003Cnone\u003E    96614d543534   3 months ago    158.6MB   158.6MB       8.502kB       0\n\u003Cnone\u003E                \u003Cnone\u003E    0305eeb39a68   3 months ago    1.602GB   1.224GB       377.7MB       0\n...\n"}]}]}]},{type:a,value:c},{type:b,tag:r,props:{id:I},children:[{type:b,tag:e,props:{href:"#docker-system-prune",ariaHidden:l,tabIndex:m},children:[{type:b,tag:n,props:{className:[o,p]},children:[]}]},{type:a,value:J}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Такое дело тоже нужно подчищать:"}]},{type:a,value:c},{type:b,tag:g,props:{className:[h]},children:[{type:b,tag:i,props:{className:[j,k]},children:[{type:b,tag:f,props:{},children:[{type:a,value:"docker system prune -a\n"}]}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Эта "},{type:b,tag:e,props:{href:"https:\u002F\u002Fdocs.docker.com\u002Fengine\u002Freference\u002Fcommandline\u002Fsystem_prune\u002F",rel:[s,t,u],target:v},children:[{type:a,value:"команда"}]},{type:a,value:" удаляет все неиспользуемые контейнеры и имеджи."}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Я прогнал эту команду у себя на ноуте, получил простыню, типа такой:"}]},{type:a,value:c},{type:b,tag:g,props:{className:[h]},children:[{type:b,tag:i,props:{className:[j,k]},children:[{type:b,tag:f,props:{},children:[{type:a,value:"Deleted Containers:\nc9804dc9ae2efff752ce11d9f5399a6c2036cf468e95a5d1f10a88e7355af7bf\nbff1fa272c698ebd1cc70d579efc47dd12ae8c67e8c9be5ebd82be69809b8ab6\ncdfc012534bb1db0ac67d5a931af308006af852626f49cbf8547835ef08c1035\n249d90e26a92138f3db9c946dfcff239fd6225e44ed6ad6591d3ba4c99331074\ncd5e984e38e70a4af94a467cce5b473c929f3f7c72125891ae2d662e86d75742\neb81a37a7ca0688faf623b6c8f26f9caf4f3311edf240f2049ce81bea17685c3\n4ab0491a9de79c0d9fc7cdc6e38e43c073c983e7dc2a53839e0aa8d63c281c2e\n\nDeleted Images:\ndeleted: sha256:85813dd6c0a75afb36af44354f6140eb622b6f7ff5f92e116eda147e5ed97226\ndeleted: sha256:b8086aad339e150fa5e9240ac815677875fc65fb8a3ee5ca7deb8f603e33036d\ndeleted: sha256:740049f94794d34f88b0fc1c4937be2e8b4a8d6dc1ae8aa3f14aa850fd9f9423\n"}]}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"А также приятное сообщение в конце:"}]},{type:a,value:c},{type:b,tag:g,props:{className:[h]},children:[{type:b,tag:i,props:{className:[j,k]},children:[{type:b,tag:f,props:{},children:[{type:a,value:"Total reclaimed space: 20.05GB\n"}]}]}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Ну и, соответственно, при каждом деплое такую команду стоит прогонять (с опцией "},{type:b,tag:f,props:{},children:[{type:a,value:"-f"}]},{type:a,value:" для запуска без запроса подтверждения)"}]},{type:a,value:c},{type:b,tag:z,props:{id:K},children:[{type:b,tag:e,props:{href:"#%D0%B5%D1%89%D0%B5-%D0%BF%D0%B0%D1%80%D0%B0-%D1%80%D0%B5%D0%BA%D0%BE%D0%BC%D0%B5%D0%BD%D0%B4%D0%B0%D1%86%D0%B8%D0%B9",ariaHidden:l,tabIndex:m},children:[{type:b,tag:n,props:{className:[o,p]},children:[]}]},{type:a,value:L}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:b,tag:"em",props:{},children:[{type:a,value:"(на самом деле всего одна пока)"}]}]},{type:a,value:c},{type:b,tag:r,props:{id:M},children:[{type:b,tag:e,props:{href:"#%D1%8E%D0%B7%D0%B0%D1%82%D1%8C-cdn",ariaHidden:l,tabIndex:m},children:[{type:b,tag:n,props:{className:[o,p]},children:[]}]},{type:a,value:N}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Если в приложении есть функционал загрузки файлов, то лучше хранить файлы в CDN."}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"CDN - content delivery network - что-то типа хранилище статики (картинок, документов и тд)."}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Если заливать файлы на CDN, то они не будут занимать место на машинке + не надо будет морочиться с сервом статики.\nCDN будет эффективно предоставлять доступ к файлам + для любого файла можно сгенерить ссылку на скачивание."}]},{type:a,value:c},{type:b,tag:d,props:{},children:[{type:a,value:"Примеры CDN: "},{type:b,tag:e,props:{href:"https:\u002F\u002Faws.amazon.com\u002Fru\u002Fs3\u002F",rel:[s,t,u],target:v},children:[{type:a,value:"Amazon S3"}]},{type:a,value:O},{type:b,tag:e,props:{href:"https:\u002F\u002Fcloud.yandex.ru\u002Fservices\u002Fstorage",rel:[s,t,u],target:v},children:[{type:a,value:"Yandex Object Storage"}]},{type:a,value:O},{type:b,tag:e,props:{href:"https:\u002F\u002Fcloud.google.com\u002Fstorage",rel:[s,t,u],target:v},children:[{type:a,value:"Google Cloud Storage"}]}]}]},dir:"\u002Fdev",path:"\u002Fdev\u002Fdu",extension:".md",createdAt:P,updatedAt:P}}],fetch:{},mutations:[]}}("text","element","\n","p","a","code","div","nuxt-content-highlight","pre","language-text","line-numbers","true",-1,"span","icon","icon-link",3,"h3","nofollow","noopener","noreferrer","_blank","du","df",2,"h2","sistema","Система","varlogjournal","\u002Fvar\u002Flog\u002Fjournal","docker","Docker","docker-system-df","docker system df","docker-system-prune","docker system prune","eshche-para-rekomendaciy","Еще пара рекомендаций","yuzat-cdn","Юзать CDN",", ","2022-06-01T15:22:47.342Z")));